<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>FridgeBridge</title>
    <!-- CSS  -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">


</head>

<body>
    <div id="food"></div>

    <div id="results"></div>
    <!-- Materialize Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- FireBase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCBdrmu0Zh7QJ4dl4IV9HCZNCH4y7QP9Lw",
            authDomain: "test-43928.firebaseapp.com",
            databaseURL: "https://test-43928.firebaseio.com",
            projectId: "test-43928",
            storageBucket: "test-43928.appspot.com",
            messagingSenderId: "668914477501"
        };
        firebase.initializeApp(config);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
        var database = firebase.database();
        var foods;
        var food;
        var queryURL = "https://api.nal.usda.gov/ndb/nutrients/?format=json&api_key=JrdeqppR6h6iZFOFYmbUU6ECER95OYP0wl73znKp&fg=0900&nutrients=208&max=1500";
        var outputs = new Array();  //json outputs
        var apiOutputs = new Array(); //api outputs
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function (response) {
            $.get("/api/results/", function (data) {
                foods = response.report.foods;
                console.log(response);
                for (var i = 0; i < foods.length; i++) {
                    var foodname = foods[i].name.toLowerCase();
                    apiOutputs.push(foodname);
                }
                console.log(apiOutputs);
                // console.log(response.report.groups[0].description);
                console.log(data);
                for (var i = 0; i < data.responses[0].labelAnnotations.length; i++) {
                    var resp = data.responses[0].labelAnnotations[i].description.toLowerCase();
                    outputs.push(resp);
                    console.log("input " + resp);
                }
                console.log(outputs);
                //cross-reference json and api outputs
                for(var i=0; i<outputs.length;i++){
                    for(var j=0; j<apiOutputs.length;j++){
                        // console.log(apiOutputs[j]);
                        if (apiOutputs[j].includes(outputs[i]) || apiOutputs[j].includes(outputs[i] + ",")) {
                            food = outputs[i];
                            console.log(apiOutputs[j] + "=> " + food);
                            break;
                        }
                    }
                }
                console.log("This : " + food);
                // if (data) {
                //     $("#food").text(data.responses[0].labelAnnotations[1].description);
                //     food = data.responses[0].labelAnnotations[1].description.toLowerCase().trim();
                // }

                $("#results").html("");
                // for (var i = 0; i < foods.length; i++) {
                //     var foodname = foods[i].name.toLowerCase();
                //     if (foodname.includes(food) || foodname.includes(food + ",")) {
                //         console.log(foodname);
                //         $("#results").append("<div class='row'> <div class='col s12 m6'> <div class='card'> <span class='card-title'>" + foods[i].name + "</span><p>" + foods[i].nutrients[0].gm + "kcal for 100 g </p> </div> </div> </div>");
                //         // console.log(foods[i].name);
                //         // console.log(foods[i].nutrients[0]);
                //         //save to database
                //         // console.log(results);
                //         database.ref().push({
                //             food: foodname,
                //             sugar: foods[i].nutrients[0]
                //         });
                //     }
                // }
            });
        });

    </script>
</body>

</html>